# 오라클DB 공부 20210902

## LIKE : 특정패턴을 가지고 있는 조건을 검색

LIKE는 WHERE 조건절 뒤에 오는 연산자로, 특정패턴을 가진 데이터를 검색하는 기능을 가지고 있다.

특정 패턴을 설정하는 방법은 '%'와 '_'로 설정할 수 있다.
% : 글자 수, 문자 제한이 없다. 무엇이든 와도 상관없다는 뜻으로 생각하면 편하다.
_ : 글자수에 제한을 두고, 어떤 문자가 와도 상관이 없다.

EX) WHERE ENAME LIKE '%S' : 이름이 S로 끝나는 데이터를 찾는다. 앞 문자는 어떤 문자가 와도 상관없다.
WHERE ENAME LIKE '\_\_S%' : 세 번째 글자가 S인 데이터를 찾는다, 첫 번째, 두 번째 문자와 뒷 문자는 어떤 문자가 와도 상관없다.

## ORDER BY : 자료 정렬시 사용

SELECT 문장의 맨 마지막에 오는 키워드로, ASC를 입력하면 오름차순, DESC를 입력하면 내림차순으로 정렬하도록 할 수 있다.

AEC의 경우에는 생략이 가능하다.
NULL값의 경우 오름차순에서는 제일 나중에 나오고, 내림차순일 경우에는 제일 먼저 나온다.

EX) SELECT \* FROM MEMBER10 ORDERBY MEMNAME ASC, AGE DESC;
MEMBER10 테이블의 이름을 오름차순으로 정렬한다. 만약 이름이 중복된다면 나이를 내림차순으로 정렬한다.
ORDER BY에는 여러 개의 컬럼을 정렬할 수 있는데, 맨 앞의 컬럼부터 정렬순위가 정해지는 방식이다.

## NOT : 부정의 의미를 가진 키워드

    긍정의 쿼리문을 작성 후 NOT을 넣어주어 사용한다. NOT은 관게연산자의 앞에 붙여주며,
    비교연산자를 사용하는 겨웅에는 WHERE 뒤에 붙여준다.

    EX) WHERE ADDR NOT LIKE '경기도%';      경기도로 시작하지 않는 주소를 불러오도록 한다.
        WHERE NOT OUTPUT_PRICE < 1000000;   출고가가 1000000원 이상인 데이터를 불러온다.

# 주로 사용하는 그룹함수

    AVG() : 평균값을 구해주는 함수, 매개값으로 컬럼을 넣어줄 수 있다.
    COUNT() : 행의 갯수를 구해주는 함수이다. NULL은 COUNT에 포함되지 않는다.
    MAX() : 컬럼의 값들 중 최댓값을 구해주는 함수이다.
    MIN() : 컬럼의 값들 중 최솟값을 구해주는 함수이다.
    SUM() : 컬럼들의 데이터 값들을 합한 값을 구해주는 함수이다.

# 시퀀스(SEQUENCE)

오라클에서는 자동순번을 부여하는 기능이 없는데, 대신 시퀀스를 사용할 수 있다.
시퀀스는 순번을 정할 때 사용하는 문법을 말한다. 시퀀스를 사용하는 이유는 스레드와 관련이 있는데,
A, B, C, D 라는 유저가 게시물을 작성하고 있다. 왼쪽부터 먼저 들어온 순서대로 게시물을 작성하였으나,
게시글을 업로드한 순서는 C, B, A, D 순서가 되었다. 이 경우, 게시물 순번은 업로드가 먼저 이루어진 C부터 순번이 부여되어야 한다.
따라서 순번을 업로드 된 순서대로 부여하기 위해 시퀀스를 사용한다.

## 시퀀스 생성

CREATE SEQUENCE (시퀀스이름) START WITH (시작 수) INCREMENT BY (증가할 수);
시퀀스를 생성하기 위해서는 시퀀스 이름을 생성하고, 시퀀스의 시작하는 수와, 몇 씩 수를 증가시킬 지를 정해서 생성할 수 있다.

## CACHE_SIZE

시퀀스를 생성하면 시퀀스 정보에 CACHE_SIZE 항목을 볼 수 있다. 기본값은 20으로 설정되어있는데, 20의 용량만큼 데이터를 임시저장하여
사용한다는 뜻이다. 캐시메모리는 휘발성 메모리로, 만약 서버(컴퓨터)가 갑자기 꺼지는 상황이 발생하면 캐시메모리에 저장되어있던
20의 용량에 있던 값들은 사라지게 된다. 순번20번 까지를 캐시메모리에 미리 저장해놓은 상태에서 게시글이 10개가 작성되어 순번이 10까지 부여되어 DB에 저장되어있었는데, 컴퓨터가 꺼진다면
다시 서버를 동작시켰을 때 시퀀스는 21부터시작하게 된다. 이러한 문제가 발생할 수 있기 때문에 캐시메모리는 안 사용하는 것을 권장한다.

### 시퀀스이름.NEXTVAL : 시퀀스의 다음 번호를 부여하는 문법

# JOIN ~ ON

    테이블과 테이블을 결합한, 특정데이터를 불러오고 싶을 떄 사용하는 키워드이다.
    JOIN의 종류에는 4가지 종류가 있다.

    1. CROSS JOIN : 2개 이상의 테이블이 조인되었을 때 조건없이 모두 결합된다. 테이블의 전체 행과 컬럼이 조인되기 때문에 중복값이 많아진다.

        EX) SELECT * FROM EMP, DEPT;
            단순히 EMP와 DEPT의 테이블을 합친 데이터들이 출력된다. 조건없이 결합되기 때문에 중복값이 많아져 효율적인 데이터이지 못하다.

    2. EQUI JOIN : 조인이 대상이 되는 두 테이블에서 공통으로 존재하는 컬럼을 연결하여 결과를 생성하는 방법이다.
    공통되는 컬럼은 컬럼이름이 일치할 수 있기 때문에 따로 별칭을 설정하여 구분해 주는 것이 좋다.

        EX) EMP테이블에서 사원의 사번, 이름, 담당업무, 부서번호, 부서명, 근무 위치를 출력해야할 때, EMP 테이블에는 부서명, 근무위치가 없어서 DEPT 테이블에서 가져와야하는 상황이 생긴다.
        SELECT E.EMPNO, E.ENAME, E.JOB, E.DEPTNO, D.DNAME, D.LOC
        FROM EMP "E"
        JOIN "DEPT"
        ON E.DEPTNO = D.DEPTNO;

        이 경우 JOIN 키워드를 사용하여 DEPT 테이블을 불러온 후 , ON 키워드를 사용하여 공통된 컬럼인 DEPTNO를 '=' 연산자로 연결해주어 각 테이블을 연동시킨다. FROM과 JOIN에 작성한 테이블의 별칭을 정해주면 테이블.컬럼명을 통해 같은 컬럼이라도 구분할 수 있게 문장을 작성할 수 있다.

    3. SELF JOIN : 자기 자신의 테이블을 조인하는 방법이다. 오라클DB 특성상 자기 자신의 DB를 FROM문에서 2번 작성하는 것이 불가능하기 때문에 셀프조인을 사용한다.

        EX) SELECT E1.ENAME, E1.JOB, E2.ENAME "MANAGER" FROM EMP "E1" JOIN EMP "E2" ON E1.MGR = E2.ENAME WHERE E1.JOB = 'CLERK';

        만약 직무가 'CLERK'인 직원의 관리자 이름을 알고 싶을 때 어떻게 해야할까? 각 직원의 관리자는 사번으로 되어있어 이름을 알기가 힘들다. 따라서 셀프조인을 통해 E1의 MGR과 E2의 ENAME을 연결시켜서 사번 대신에 관리자의 이름이 나오도록 설정하는 것이 가능하다.

    4. OUTER JOIN : 2개 이상의 테이블이 조인이 될 때 어느 한 쪽 테이블에는 해당하는 데이터가 다른쪽 테이블에 존재하지 않을 경우 그 데이터가 출력되지 않을 수 있다. 따라서, 정보가 부족한 테이블의 칼럼 뒤에 '(+)' 기호를 붙여서 데이터가 출력되도록 할 수 있다.

        EX) SELECT E1.ENAME "NAME" , E2.ENAME "MANAGER" FROM EMP "E1" JOIN EMP "E2" ON E1.MGR = E2.EMPNO(+);

        EMP의 관리자와 사번을 조인하려고 한다. 근데 직원 중에 CEO 직급인 KING 사원의 경우에는 관리자가 없어서 데이터 값이 NULL이다. 이 경우, 출력이 되지 않는다. 따라서 EMPNO에 (+)기호를 달아서 NULL 값인 데이터도 출력이 되도록 하였다.

# DUAL TABLE : 오라클에서 제공하는 함수

    DUAL TABLE에는 오라클에서 제공하는 함수들을 사용할 수 있다. 간단하게 함수를 만들어서 사용할 수 있는 하나의 행, 하나의 컬럼만들 담고있는 테이블로, 계산 및 데이터를 가공하기 위해서 사용되는 함수이다.

## 날짜와 관련된 함수

    SYSDATE : 현재 시스템의 날짜를 불러온다. 오라클 DB에서는 날짜 간에 +,-를 통한 연산이 가능한데, +는 다음 날짜, -는 이전 날짜로 계산이 되어진다.

    ADD_MONTHS(DATE, MONTH) : DATE 자료형에 월 을 더할 수 있는 함수이다.

    NEXT_DAY(DATE, '요일') : DATE 데이터를 기준으로 요일을 체크하여 요일이 지났으면 다음주 요일, 지나지 않았으면 이번주 요일을 DATE 형식으로 표기한다. 한국어로 설정되어있어서 그런지 '요일'은 한글로 입력해야한다.

    LAST_DAY(DATE) : 달의 마지막 날을 구해주는 함수이다. DATE 자료형을 넣어주면 그 달의 마지막 날을 출력하여 보여준다.

    MONTHS_BETWEEN() : 두 날짜 사이의 개월 수 차이를 구하는 함수이다. 계산이 되면 일 단위로 출력되며, 뒤에 무수히 많은 소수점이 출력되는 것으로 보아 시간 단위까지 계산이 되는 것으로 보인다.

    TO_CHAR() : 형식에 맞게 문자열로 날짜를 출력할 수 있도록 해주는 함수이다. WINDOW에서는 기본적으로 YY/MM/DD 형식으로 되어있는데, 이 형식을 다른 형식으로 바꿀 수 있다.

        EX) SELECT TO_CHAR(SYSDATE, 'yyyy-MM-dd') FROM DUAL;
            현재 날짜를 'yyyy-MM-dd' 형식으로 바꾼다.

## 문자와 관련된 함수

    UPPER(), LOWER(), INITCAP() : 영문자에 사용되는 함수, 대문자, 소문자로 바꿀 수 있는 함수이며 INITCAP() 함수와 같은 경우 첫 영문자만 대문자로 바뀌고 나머지는 강제로 소문자로 바뀐다.

    LENGTH(), LENGTHB() : 문자의 길이를 구하는 함수이다. LENGTH()는 자바에서도 많이 사용한 메소드인데, 단순히 문자의 길이를 구하기 때문에 이해가 빨리 될 것이고, LENGTHB() 함수는 문자의 바이트 수를 구하는 함수이다. 보통 한글은 한 글자에 2바이트로 계산이 되고, 숫자나 영문자는 1바이트로 계산이 된다.
    단, 인코딩방식이 UTF-8인 경우에는 3씩 바이트가 잡히니, 유념해야한다.

    CONCAT(), || : 문자열을 연결해주는 함수이다. 보통 CONCAT() 보다는 || 가 범용성이 더 좋기 때문에 ||를 더 많이 사용한다.

    LPAD('STR', '전체자릿수', '늘어난 자릿수에 채울 문자'), RPAD() : 문자의 자릿수를 늘려주는 함수이다. LPAD는 왼쪽, RPAD는 오른쪽의 자릿수를 늘린다. 문자열이나 컬럼을 매개값으로 넣어주고, 늘릴 자릿수와 늘어난 자릿수에 채울 문자를 써주면 되는데, 데이터의 자릿수를 강제로 맞추기 때문에 자릿수에 채워줄 문자를 적어주는 것이 좋다.

        EX) SELECT LPAD(ENAME, 10, '*') FROM EMP;
            - ENAME 컬럼의 자릿수를 10자리로 설정, 왼쪽부터 빈 값은 '*'로 채운다.
            SELECT RPAD(ENAME, 10, '1234567890') FROM EMP;
            - ENAME 컬럼의 자릿수를 10자리로 설정, 오른쪽부터 빈 값은 '123456789'로 채운다. 예를 들어 빈 값이 3자리일 경우 '123'만 채워지는 방식이다.

    LTRIM(), RTRIM() : 문자를 지워주는 함수이다. 왼쪽 오른쪽 함수 2가지로 구분한다.

    REPLACE(컬럼/문자, 찾을문자열, 변경할문자열) : 문자열을 교체해 주는 함수이다. 컬럼에 저장되어있는 전체 데이터값중에 찾을 분자열을 변경할 문자열로 전부 바꿔주는 함수.
