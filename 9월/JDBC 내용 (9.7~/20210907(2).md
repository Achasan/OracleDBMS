2021.09.07 오후 자바수업 : Java-DB 연동

# JDBC(Java Database Connectivity)

    JDBC는 Driver를 통한 자바와 데이터베이스에 연결과 작업을 하기위한 목적으로 만들어진 클래스이다.
    JDBC는 자바 표준 인터페이스로, API로 제공되어지는 공식 인터페이스이다.
    자바와 DB간의 통신역할을 하는 클래스로, 중계적 역할을 하는 클래스이다. 따라서 DB와 연결할 때 중요한 클래스이다.

## JDBC의 주요 인터페이스
    
    - java.sql.driver : 데이터베이스에서 사용되는 드라이버 인터페이스.
    - java.sql.connection : 데이터베이스 연결 정보를 가지고 있는 인터페이스
    - java.sql.PreparedStatement : statement 인터페이스의 서브 인터페이스로서, DB에 SQL문을 전송하는 방법을
                                   알고 있는 인터페이스이다.
    - java.sql.ResultSet : 데이터베이스의 실행 결과를 가지고 있는 인터페이스이다.



# 오라클DB와 Java를 연결하는 방식

    오라클 DB를 배웠으므로 이제 Java와 오라클DB를 연결시켜서 사용해야한다.
    자바에서 제공하는 JDBC클래스를 이용하여 오라클 DB와 Java를 연결시켜보자. 
    절차가 꽤나 복잡하다. 연결방법을 알아야 나중에 JSP나 Spring에서도 사용이 가능하므로 꼭 알아두도록 하자.

    1. 물리적 연결 By 드라이버

        먼저 Java와 오라클 DB를 연결시키기 위해서는 드라이버를 통해 서로 연결해주어야 한다.

        우리가 컴퓨터를 새로 사서 OS를 설치하고 부팅을 하면 OS에서 처음 하는 행동이 현재 연결되어있는
        모니터, 마우스, 키보드, 스피커 등의 기기 드라이버를 설치하는 것이다.
        OS자체로는 기기의 정보가 어떤 것인지 알기 힘들기 때문에 드라이버를 설치해주어 기기가 가지고 있는 기능, 스펙 등을
        OS에 입력하여 적절한 기능을 사용할 수 있도록 하는 것이다.

        자바도 같다. 자바에 오라클 DB의 드라이버를 설치하여 JDBC클래스에서 오라클DB와 연결할 수 있도록 하기 위해서
        오라클 DB 내에 있는 자바드라이버 파일을 Java에 연결하는 것이다.

        자바가 설치된 파일에 dbhomeX\jdbc\lib 폴더에 보면 ojdbc8.jar 이라는 파일이 있다. 이 파일을 연동하고자 하는 프로젝트 
        폴더 우클릭-[Build Path]-[Configure Build Path]를 누르고, Library 탭에서 add External jars를 클릭하여 해당 파일을
        추가시켜주면 드라이버 연결은 완료된 것이다.


    2. JDBC URL
    
        드라이버 연결을 완료했다면 이제 자바를 통해 오라클 DB에 접속할 차례이다.
        드라이버 연결을 했다고 해서 DB와 연결된 것이 아니다. 드라이버는 오라클 DB에 대한 정보를 알려주는 것이지,
        DB와 직접적으로 연결하는 것은 아니다. 연결을 하기 위해서는 JDBC URL을 통해서 접속을 해야하는데,

        네이버가 www.naver.com 구글이 www.google.com인 것처럼 웹사이트의 IP주소가 아닌 도메인을 통해 들어간다.
        오라클DB도 JDBC URL 형식을 통해 접속한다.
        오라클 URL은 보통 'jdbc:oracle:thin:@host주소:포트:DB식별자(SID)'를 통해서 DB에 접속한다.

    
    3. 드라이버 로딩
        
        JDBC URL을 알아냈다면 이제 JDBC API를 바탕으로 오라클 드라이버를 메모리로 업로드 시켜주어야 한다.
        드라이버를 메모리로 업로드 시키는방법은 Class.forName(드라이버객체)을 사용한다.
        특정 클래스를 로딩하면 자동으로 객체가 생성이 되고, DriverManage에 등록이 되는데,
        일반적으로 드라이버 클래스들은 로드될 때 자신의 인스턴스를 생성하고, 자동적으로 DriverManage 클래스 메소드를
        호출하여 인스턴스를 등록하는 방식이다. 
        DriverManager가 있는 위치는 oracle.jdbc.driver.OracleDriver 이다.

        forName()메소드는 Class 클래스에 포함되어있고, 해당 파일 경로에 위치한 파일을 동적으로 프로그램이 실행될 때
        메모리에 업로드시키는 기능을 수행한다.


    4. 커넥션 연결
        
        설치된 드라이버를 메모리 상에 업로드 시켰다면 DB를 사용하는 프로그램(자바)와 연결할 준비를 끝마친 것이다.
        프로그램과 DB를 연결시키는 것을 커넥션이라고 한다.
        DriverManager 클래스는 데이터 원본에 JDBC 드라이버를 통해서 커넥션을 만드는 역할을 한다.
        DriverManager 클래스의 getConnection() 메소드를 이용해 자신이 사용하는 오라클 정보를 인자로 전달해 연결을 수행한다.
        
        getConnection() 메소드의 매개값으로는 오라클서버의 ip가 필요한데, 보통 자신 컴퓨터에 연결할 경우에는 'localhost'를 입력하면 되며, 리스너포트, 오라클 계정, 계정 비밀번호를 순서대로 매개값으로 넣어주면 된다.



## 요약

    이론 설명이 매우 길었는데, 간단하게 요약하자면

    1. 오라클 DB 설치폴더 내에 있는 JDBC 드라이버 파일을 자바 프로젝트폴더와 연결시킨다.

    2. JDBC URL을 알아낸다. 내가 연결하고자 하는 오라클 DB의 아이피, 포트, DB식별자를 오라클 DB에서 알아낸다.

    3. 드라이버를 연결했다면 OracleDriver.class 파일을 찾아야한다. 연결한 ojdbc8.jar 파일 안에 많은 패키지들이 있는데,
        여기서 oracle.jdbc.driver 패키지 안에 있는 OracleDriver.class 파일을 드라이버로 사용할 수 있다.

    4. Class.forName(드라이버주소) 메소드를 실행하여 드라이버를 메모리에 등록한다. 드라이버를 메모리에 등록하면
        자동적으로 DriverManager 클래스에 인스턴스가 들어가게 된다.

    5. DriverManage 클래스에 저장된 오라클 DB 정보를 통해 이제 연결할 수 있다. 메소드인 getConnection() 메소드를 사용하여
        DB에 연결하자. getConnection() 메소드의 매개값으로는 ip주소, 계정이름, 계정비밀번호, DB연산자를 넣어주어야한다.
        연결이 완료되면 연결정보를 Connection 클래스에 저장할 수 있다. Connection 클래스를 생성하여 연결정보를 저장해주도록 하자.

    6. 연결을 했으면 이제 자바측에서 쿼리문을 DB쪽으로 보내보도록 한다. Connection 클래스에는 prepareStatement()라는 메소드가 있는데,
        작성한 쿼리문을 PrepareStatement 클래스에 보낸다. PrepareStatement 클래스는 원활한 쿼리문 전달이 될 수 있도록 수정할 수 있는
        클래스이다.

    7. PrepareStatement에는 executeQuery(), executeUpdate() 등 쿼리문을 보내기 위한 메소드들이 존재한다.
        어떤 쿼리문을 사용하느냐에 따라 다른데, SELECT문 같은 결과값을 가져오는 경우에는 executeQuery(),
        결과값이 없이 데이터 추가, 수정, 삽입만 하는 INSERT, UPDATE, DELETE 같은 경우에는 executeUpdate() 메소드를 사용한다. 
        메소드를 사용하여 DB에 쿼리문을 넘겨서 실행시키도록 한다.

    8. 어떤 쿼리문을 보내느냐에 따라서 결과값을 받을 수도 있고, 안 받을 수도 있다. 예를 들어 쿼리문을 SELECT문으로 보냈다면, 
       DB에서는 결과 데이터들을 모아서 자바쪽으로 보내줄 것이고, UPDATE, INSERT, DELETE와 같은 DB 내의 데이터만 수정하는 쿼리문을
       작성한다면 DB에서는 결과값을 리턴하지 않을 것이다.

       8-1. 결과값을 리턴하는 SELECT 문을 DB에 보냈을 경우, executeQuery() 메소드를 사용했을 것이다. executeQuery() 메소드는 
            결과값들을 ResultSet 객체로 리턴한다. ResultSet 객체를 생성하여 결과값을 받아주도록 한다.
            ResultSet 객체는 SQL한테서 받은 데이터들을 관리할 수 있는 클래스이다. 사용방식은 약간 StringTokenizer와 비슷한 것 같다.

       8-2. 결과값을 리턴하지않는 INSERT, UPDATE, DELETE 문의 경우에는 결과값을 받아올 필요가 없으니 쿼리문을 넘겨서 실행되었다면
            거기서 끝이다. 확인해보겠다면 SELECT문을 만들어서 다시 불러와도 된다.
    
    9. DB를 연결하여 여러가지 작업을 처리하고 난 다음에는 남아있는 객체들을 닫아주어, 메모리를 다시 반환하도록 한다.
        각 객체에는 close() 메소드가 있다. Connection, PreparedStatement, ResultSet 객체들을 모두 닫아주도록 하여 원활한
        메모리 구동이 될 수 있도록 한다.


    자바와 DB순서를 수업에서 코드로 구현해 본 과정을 정리해보면 위와 같다. 나머지 실습파일은 자바파일로 따로 업로드하고, 
    주석을 적어서 마무리하였다.
    

    오늘 작성한 내용은 20210908 마크다운과 이어질 예정이다.
    